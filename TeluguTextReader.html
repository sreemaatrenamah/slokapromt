<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telugu Stotram Reader 2026</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans Telugu', sans-serif; background: #f4f7f6; padding: 20px; color: #222; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .input-section { padding: 25px; border-bottom: 2px solid #f0f0f0; background: #fff; }
        
        textarea { width: 100%; min-height: 100px; padding: 15px; font-family: 'Noto Sans Telugu', sans-serif; border: 2px solid #dfe1e5; border-radius: 8px; margin-bottom: 15px; font-size: 18px; line-height: 1.6; }
        .controls { display: flex; gap: 15px; align-items: center; justify-content: space-between; }
        button { padding: 12px 24px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: background 0.3s; font-size: 16px; }
        #startBtn { background: #34a853; color: white; }
        #stopBtn { background: #ea4335; color: white; display: none; }

        .speed-box { display: flex; align-items: center; gap: 10px; font-size: 14px; color: #555; background: #eee; padding: 5px 15px; border-radius: 20px; }
        .speed-val { font-weight: bold; color: #1a73e8; font-size: 18px; min-width: 35px; text-align: center; }

        .reading-area { padding: 60px 40px; background: #fff; min-height: 500px; position: relative; }
        .line-wrapper { position: relative; margin-bottom: 45px; width: fit-content; display: block; }
        .text-line { font-size: 34px; line-height: 1.4; color: #111; white-space: nowrap; position: relative; z-index: 2; }
        
        /* Static Size Horizontal Gliding Cursor */
        .cursor-glide {
            position: absolute;
            bottom: -8px; /* Positioned directly below the text */
            left: 0;
            height: 5px;
            width: 40px; /* FIXED STATIC WIDTH */
            background: #1a73e8;
            border-radius: 3px;
            pointer-events: none;
            z-index: 1;
            display: none;
            box-shadow: 0 2px 5px rgba(26, 115, 232, 0.4);
        }
    </style>
</head>
<body>

<div class="container">
    <div class="input-section">
        <h2 style="text-align:center; color:#1a73e8; margin-bottom:15px;">Telugu Stotram Reader</h2>
        <textarea id="textInput" placeholder="Paste Telugu text here...">ఓం నమశ్శివాయ కాంచన మణిమాల || 1 ||
వందే శంభుముమాపతిం సురగురుం || 2 ||</textarea>
        <div class="controls">
            <div>
                <button id="startBtn">Start Reading</button>
                <button id="stopBtn">Stop</button>
            </div>
            <div class="speed-box">
                <span>Speed:</span>
                <input type="range" id="speedControl" min="5" max="100" value="40">
                <span id="speedDisplay" class="speed-val">40</span>
            </div>
        </div>
    </div>
    <div class="reading-area" id="displayArea"></div>
</div>

<script>
    const textInput = document.getElementById('textInput');
    const displayArea = document.getElementById('displayArea');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const speedControl = document.getElementById('speedControl');
    const speedDisplay = document.getElementById('speedDisplay');

    let isReading = false;
    let currentLineIdx = 0;
    let animationFrame = null;

    speedControl.addEventListener('input', (e) => {
        speedDisplay.textContent = e.target.value;
    });

    function processText() {
        const lines = textInput.value.split('\n').filter(l => l.trim() !== "");
        displayArea.innerHTML = lines.map((line, i) => `
            <div class="line-wrapper" id="row-${i}">
                <div class="text-line">${line}</div>
                <div class="cursor-glide" id="cursor-${i}"></div>
            </div>
        `).join('');
        return lines;
    }

    function animateLine(lines) {
        if (!isReading || currentLineIdx >= lines.length) {
            stopReading();
            return;
        }

        const cursor = document.getElementById(`cursor-${currentLineIdx}`);
        const row = document.getElementById(`row-${currentLineIdx}`);
        
        // Setup Cursor
        cursor.style.display = 'block';
        cursor.style.left = '0px';
        
        row.scrollIntoView({ behavior: 'smooth', block: 'center' });

        const currentText = lines[currentLineIdx];
        const rowWidth = row.offsetWidth;
        const cursorWidth = 40; // Matching the CSS width
        const scrollDistance = rowWidth - cursorWidth;

        // Speed Logic: duration based on width and slider
        const speedValue = parseInt(speedControl.value);
        const speedFactor = (105 - speedValue);
        const duration = (rowWidth / 100) * speedFactor * 40; 

        let startTime = null;

        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Glide the cursor from 0 to the end of the text width
            const currentPos = progress * scrollDistance;
            cursor.style.left = currentPos + 'px';

            if (progress < 1 && isReading) {
                animationFrame = requestAnimationFrame(step);
            } else if (isReading) {
                // Pause Logic for Slokas
                const isSlokaEnd = /\|\||॥/.test(currentText);
                const pauseTime = isSlokaEnd ? 1800 : 400;

                setTimeout(() => {
                    cursor.style.display = 'none';
                    currentLineIdx++;
                    animateLine(lines);
                }, pauseTime);
            }
        }
        animationFrame = requestAnimationFrame(step);
    }

    startBtn.addEventListener('click', () => {
        const lines = processText();
        if (lines.length === 0) return;
        
        isReading = true;
        currentLineIdx = 0;
        startBtn.style.display = 'none';
        stopBtn.style.display = 'inline-block';
        animateLine(lines);
    });

    function stopReading() {
        isReading = false;
        cancelAnimationFrame(animationFrame);
        startBtn.style.display = 'inline-block';
        stopBtn.style.display = 'none';
        document.querySelectorAll('.cursor-glide').forEach(c => c.style.display = 'none');
    }

    stopBtn.addEventListener('click', stopReading);
</script>
</body>
</html>
